{% extends 'base.html' %}
{% block title %} {{lesson.title}}{% endblock %}

{% block media %}
<script type="text/javascript">
        require(['./common',], function(){
            require(["jquery", "colorbox"], function($){
                $(".tech").colorbox({
                    inline:true,
                    width:"50%",
                    href:function(){
                        return $(this).siblings('.video-row').children('.chef-movie-video');
                    }
                })
                $('#myModal').on('show', function (e) {
                    if (!data) return e.preventDefault() // stops modal from being shown
                })
                $('.carousel').on('slid', function (e) {
                    idx = $('.carousel').find('.active').index()
                    $('#lesson-timeline-images').children().removeClass('lesson-timeline-picture-active')
                    to_activate = $('#lesson-timeline-images').children()[idx]
                    $(to_activate).addClass('lesson-timeline-picture-active')
                });
            });
        });
                </script>
{% endblock %}

{% block content %}
<div id="lesson-wrapper" class="bordered-row">
  <div id="lessons" class="carousel slide no-margin" data-interval="false">
    <div class="carousel-inner">
      {% for step in lesson.steps.all %}
      <div class="{% if forloop.first %}active{% endif %} item">
		<img class="lesson-picture" src="{{MEDIA_URL}}{{step.picture}}" />
        <div class="step-text no-margin lesson-wrapper-overlay">
		  <a class="lesson-nav-btn-top-left" href="#lessons" data-slide="prev"><i class="icon-chevron-left"></i></a>
		  <a class="lesson-nav-btn-top-right" href="#lessons" data-slide="next"><i class="icon-chevron-right"></i></a>

		  {% if forloop.first %}
		  <div class="step-title span6">{{step.title}}</div>
		  {% else %}
		  <div class="step-title span6">Step {{step.order}}: {{step.title}}</div>
		  {% endif %}

		  <div class="step-technique span5">
			{% for tech in step.technique.all %}
			<a class="technique-{{forloop.parentloop.counter0}} step-technique-text step-title blue pull-right">Watch
			  <img class="technique-play-icon" src="{{STATIC_URL}}img/play-button-blue.png" />
			  {{tech.title}}</a>
			<!-- this should likely be moved somewhere else -->
			<div class="row no-display video-row">
			  <video class="chef-movie-video span6" controls="controls">
				<!-- Sample videos until we have our actual intro video -->
				<source src="http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4" />
				<source src="http://clips.vorwaerts-gmbh.de/big_buck_bunny.ogv" />
				<source src="http://clips.vorwaerts-gmbh.de/big_buck_bunny.webm" />
				<!-- fallback  -->

                <p>Your browser does not support HTML5 video.</p>
			  </video>
			</div>
			{% endfor %}
		  </div>

		  <div class="step-description span12">{{step.text}}</div>
		</div>

        <div id="ingredient" class="span4 no-margin lesson-panel">
          {% for ingredient in step.ingredients.all %}
          <div class='panel-item ingredient ingredient{{forloop.counter}} ingredient-{{forloop.parentloop.counter0}}-{{forloop.counter}}'>
            <div class='lesson-icon-text lesson-icon-ingredients-text'>
              <strong>
                <!-- taking out until fractions can be displayed {{ingredient.number}} -->
                {{ingredient.measurement}} {{ingredient.prep}} {{ingredient.ingredient.name}}
              </strong>
            </div>
            <div class='lesson-icon-circle lesson-icon-circle-ingredients'>
              <!-- add icons once they've been added to the data model
                   <img class='lessonimages' src='../../static/img/icon.pie.png' alt='{{ingredient.name}}' />
                   -->
            </div>
          </div>
          {% endfor %}
        </div>

        <div class="span4 pull-right">
          <div id="tools" class="lesson-panel">
            {% for tool in step.tools.all %}
            <div class='panel-item tool tool{{forloop.counter}} tool-{{forloop.parentloop.counter0}}-{{forloop.counter}}'>
			  <div class='lesson-icon-circle lesson-icon-circle-tools lesson-icon-circle-tool{{forloop.counter}}'>
			  </div>
              <div class='lesson-icon-text lesson-icon-tools-text'>
                <strong>{{tool.size}} {{tool.type}} {{tool.name}}</strong>
              </div>
			  <!-- add icons once they've been added to the data model
                   <img class='lessonimages' src='../../static/img/icon.pie.png' alt='{{tool.name}}' />
                   -->
            </div>
            {% endfor %}
          </div>
        </div>

      </div>
      {% endfor %}
    </div>
  </div>
</div>

<div id="lesson-timeline" class="row">
  <a class="lesson-nav-btn" href="#lessons" data-slide="prev"><i class="icon-chevron-left"></i></a>
  <a class="lesson-nav-btn pull-right" href="#lessons" data-slide="next"><i class="icon-chevron-right"></i></a>
  <div id="lesson-timeline-images">
	{% for step in lesson.steps.all %}
	<img class="lesson-timeline-picture{% if forloop.first %} lesson-timeline-picture-active {% endif %}" src="{{MEDIA_URL}}{{step.picture}}"/>
	{% endfor %}
  </div>
</div>


<div class="lesson-components row no-display">
  {% for step in lesson.steps.all %}
  {% for ingredient in step.ingredients.all %}
  <div id="ingredient-{{forloop.parentloop.counter0}}-{{forloop.counter}}" class="lightbox product-lightbox">
    <!-- {{ingredient.number}} -->

    <div class="row">
      <div class="span2">
        <img class="product-image" src="{{MEDIA_URL}}{{ingredient.ingredient.image}}" />
      </div>
      <div class="span4">
        <div class="row">
          <div class="span4">
            <h4>{{ingredient.ingredient.name}}</h4>
          </div>
        </div>
        <div class="row">
          <div class="span4">
            <div class="lesson-icon-circle lesson-icon-circle-products">
              <div class="span3 product-category"><strong>{{ingredient.ingredient.category}}</strong>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="span4">
            <p class=""><em>{{ingredient.measurement}} {{ingredient.prep}}</em>
            </p>
          </div>
        </div>
      </div>
    </div>

    <hr class="lightbox-hr">

    <div class="row">
      <div class="span4">{{ingredient.ingredient.description}}</div>
      <div class="span2"><strong>Substitutions</strong>
        <li>{{ingredient.ingredient.substitution1}}</li>
        <li>{{ingredient.ingredient.substitution2}}</li>
      </div>
    </div>

    <hr class="lightbox-hr">

    <div class="row">
      <div class="span4">Try <em>{{ingredient.ingredient.name}}</em> recommended by our chefs</div>
      <div class="span2">
        <a class="item-buy-button" href="{{ingredient.ingredient.product_link}}"
           target="_blank">Purchase</a>
      </div>
    </div>

    <hr class="lightbox-hr">

    <div class="row">
      <div class="span2">
        <div class="item-info">
          <a href="http://www.thefairtradewinecompany.com/varietals/chenin-blanc"
             target="_blank">
            <img class="item-image-ad" src="{{STATIC_URL}}img/fairtrade-wine.png" alt="">
          </a>
        </div>
      </div>
      <div class="span4">
        <p>Consider pairing <em>The Fair Trade Wine Company Chenin Blanc</em> with
          your <em>Citrus Vinaigrette Salad</em> and support sustainability. This South
          African wine offers a superb balance between bright acidity and sweetness.</p>
        <a
           class="item-ad-buy-button" href="http://shop.barrelcavewines.com/Fair-Trade-Wine-Company-Chenin-Blanc-FT1003.htm"
           target="_blank">Try it today</a>
      </div>
    </div>

  </div>
  {% endfor %}

  {% for tool in step.tools.all %}
  <div id="tool-{{forloop.parentloop.counter0}}-{{forloop.counter}}" class="lightbox product-lightbox">
    <div class="row">
      <div class="span2">
        <img class="product-image" src="{{MEDIA_URL}}{{tool.image}}" />
      </div>
      <div class="span4">
        <div class="row">
          <div class="span4">
            <h4>{{tool.name}}</h4>
          </div>
        </div>
        <div class="row">
          <div class="span4">
            <div class="lesson-icon-circle lesson-icon-circle-products">
              <div class="span3 product-category"><strong>{{tool.category}}</strong>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="span4">
            <p class=""><em></em>
            </p>
          </div>
        </div>
      </div>
    </div>

    <hr class="lightbox-hr">

    <div class="row">
      <div class="span4">{{tool.description}}</div>
      <div class="span2"><strong>Substitutions</strong>
        <li>{{tool.substitution1}}</li>
        <li>{{tool.substitution2}}</li>
      </div>
    </div>

    <hr class="lightbox-hr">

    <div class="row">
      <div class="span4">Try <em>{{tool.name}}</em> recommended by our chefs</div>
      <div class="span2">
        <a class="item-buy-button" href="{{tool.product_link}}"
           target="_blank">Purchase</a>
      </div>
    </div>

    <hr class="lightbox-hr">

    <div class="row">
      <div class="span2">
        <div class="item-info">
          <a href="http://www.thefairtradewinecompany.com/varietals/chenin-blanc"
             target="_blank">
            <img class="item-image-ad" src="{{STATIC_URL}}img/fairtrade-wine.png" alt="">
          </a>
        </div>
      </div>
      <div class="span4">
        <p>Consider pairing <em>The Fair Trade Wine Company Chenin Blanc</em> with
          your <em>Citrus Vinaigrette Salad</em> and support sustainability. This South
          African wine offers a superb balance between bright acidity and sweetness.</p>
        <a
           class="item-ad-buy-button" href="http://shop.barrelcavewines.com/Fair-Trade-Wine-Company-Chenin-Blanc-FT1003.htm"
           target="_blank">Try it today</a>
      </div>
    </div>

  </div>
  {% endfor %}
  {% endfor %}

  <div id="lesson-technique-videos">
    <video id="technique-7" class="technique-video" width="100%" height="auto" poster="{{STATIC_URL}}videos/orange-zesting-screenshot.png" preload="auto" controls="controls">
      <source src="{{STATIC_URL}}videos/orange-zesting-medium.mp4" />
      <source src="{{STATIC_URL}}videos/orange-zesting-medium.ogv" />
      <source src="{{STATIC_URL}}videos/orange-zesting-medium.webm" />
      <!-- fallback  -->
      <p>Your browser does not support HTML5 video.</p>
    </video>

    <video id="technique-9" class="technique-video" width="100%" height="auto" poster="{{STATIC_URL}}videos/apple-cutting-screenshot.png" preload="auto" controls="controls">
      <source src="{{STATIC_URL}}videos/apple-cutting-medium.mp4" />
      <source src="{{STATIC_URL}}videos/apple-cutting-medium.ogv" />
      <source src="{{STATIC_URL}}videos/apple-cutting-medium.webm" />
      <!-- fallback  -->
      <p>Your browser does not support HTML5 video.</p>
    </video>

    <video id="technique-10" class="technique-video" width="100%" height="auto" poster="{{STATIC_URL}}videos/pomegranate-seeding-screenshot.png" preload="auto" controls="controls">
      <source src="{{STATIC_URL}}videos/pomegranate-seeding-medium.mp4" />
      <source src="{{STATIC_URL}}videos/pomegranate-seeding-medium.ogv" />
      <source src="{{STATIC_URL}}videos/pomegranate-seeding-medium.webm" />
      <!-- fallback  -->
      <p>Your browser does not support HTML5 video.</p>
    </video>
  </div>
</div>

<script type="text/javascript">
pagelogic = function(){
    {% for step in lesson.steps.all %}
    {% for ingredient in step.ingredients.all %}
    $(".ingredient-{{forloop.parentloop.counter0}}-{{forloop.counter}}").colorbox({inline:true, width:"480px", href:"#ingredient-{{forloop.parentloop.counter0}}-{{forloop.counter}}"});
    {% endfor %}

    {% for tool in step.tools.all %}
    $(".tool-{{forloop.parentloop.counter0}}-{{forloop.counter}}").colorbox({inline:true, width:"480px", href:"#tool-{{forloop.parentloop.counter0}}-{{forloop.counter}}"});
    {% endfor %}
    {% endfor %}

    {% for step in lesson.steps.all %}
    {% for tech in step.technique.all %}
    $(".technique-{{forloop.parentloop.counter0}}").colorbox({inline:true, width:"50%", href:"#technique-{{forloop.parentloop.counter0}}"});
    {% endfor %}
    {% endfor %}

    $(document.documentElement).keyup(function (event) {
      // handle cursor keys
	  if (event.keyCode == 37 || event.keyCode == 38) {
        $('a.lesson-nav-btn-top-left').trigger('click');
      }
      else if (event.keyCode == 39 || event.keyCode == 40) {
		$('a.lesson-nav-btn-top-right').trigger('click');
      }
    });

};
</script>

{% endblock %}
