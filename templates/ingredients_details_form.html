{% extends 'base.html' %}
{% load transloadit %}

{% block media %}
<script type="text/javascript">
pagelogic = function(){
    add_ingredient = "<div class='row'>" +
        "				  <div class='span1 pull-left'>" +
        "					<a class='btn btn-green btn-save btn-add pull-left'>" +
        "					<strong>&#43;</strong>" +
        "					</a>" +
        "				  </div>" +
        "				  <div class='span2 create-lesson-add-ingredient'>" +
        "				    <span class='vertical-align'><strong>add ingredient</strong></span>" +
        "				  </div>" +
        "			    </div>"


    add_tool = "<div class='row'>" +
        "				  <div class='span1 pull-left'>" +
        "					<a class='btn btn-green btn-save btn-add pull-left'>" +
        "					<strong>&#43;</strong>" +
        "					</a>" +
        "				  </div>" +
        "				  <div class='span2 create-lesson-add-tool'>" +
        "				    <span class='vertical-align'><strong>add tool</strong></span>" +
        "				  </div>" +
        "			    </div>"




    $('.ingredient_formset').formset({
        prefix: '{{ ingredient_formset.prefix }}',
        formCssClass: 'dynamic-formset1',
        addText: add_ingredient,
    });
    $('.tool_formset').formset({
        prefix: '{{ tool_formset.prefix }}',
        formCssClass: 'dynamic-formset2',
        addText: add_tool,
    });


/*TODO: Move all this to some file **** Upload Video ****/
require(["jquery", "lib/jquery.iframe-transport", "lib/jquery.fileupload"], function($){
    $('#fileupload').fileupload({
        dataType: 'json',
        done: function (e, data) {
            $('#progress .bar').html("DONE");
        },
	progressall: function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#progress .bar').css('width', progress + '%').html(progress + "%");
    	}
    });
});
/****  End Upload Video *****/

};
</script>
{% endblock %}


{% block content %}
{% autoescape off %}
<div class="bordered-row main bordered">

    <div class="span6">
	  <div class="create-lesson-title">
	    <h2>Create New Lesson</h2>
	  </div>
	</div>

	<div class="span2 vertical-align">
	  <div class="create-step-btn">
	    <a class="btn btn-lightgray btn-create-step pull-left">
		  <span class="create-step-text">step &#160; &#160;</span><strong>1</strong>
		</a>
	  </div>
	</div>

	<div class="span2 btn-create-step-2">
	  <div class="create-step-btn">
		<a class="btn btn-darkgray btn-create-step">
		  <span class="create-step-text">step &#160; &#160;</span><strong>2</strong>
		</a>
	  </div>
	</div>

	<div class="span2">
	  <div class="create-step-btn">
		<a class="btn btn-lightgray btn-create-step pull-right">
		  <span class="create-step-text">step &#160; &#160;</span><strong>3</strong>
		</a>
	  </div>
	</div>

  <div class="span12">
	<div class="row">
	  <hr class="profile-hr" />
  </div>

  <!-- Video Upload --!>
  <div class="row"><!-- .row -->
    <div class="span8 create-lesson-title-step1">
      <h3 class="colored-header">2.1 Video</h3>
    </div>
  </div><!-- End .row-->

  <div class="row">
	  <form class="span2" method="">
		  {% csrf_token %}
		  <input type="hidden" value="{% transloadit_params %}" name="params" />
		  <input type="hidden" value="{{ lesson.id }}" name="lesson_id" />
		  <input class="create-lesson-input-file" id="fileupload"
		  	type="file"
		  	data-url="{% transloadit_url %}"
		  	name="video">
		  <span id="progress" style="height:18px;background:gray; width:300px;">
			  <div class="bar" style="width: 0%; height:100%;background:green;">0%</div>
		  </span>
	  </form>
  </div>

  <div class="row">
    <hr class="create-lesson-hr" />
  </div>
  <!-- END Video Upload --!>

	<div class="row">
	  <div class="span8 create-lesson-title-step1">
		<h3 class="colored-header">2.2 Ingredients &amp; Tools</h3>
	  </div>

	  <div class="span4 pull-right">
		<a href="#" class="create-lesson-help-btn pull-right">Need help?</a>
	  </div>
	</div>

	<div class="row">
	  <hr class="create-lesson-hr"/>
	</div>

	<div class="row">
	  <form class="profile-form" target="" action="" method="POST">
        {% csrf_token %}
		  <div class="span6">
			<div id="create-lesson-form-2-left">
				<div id="createlessontitle">
				  <h5>Ingredients</h5>
				</div>

				<div class="row">
				  <hr class="create-lesson-hr"/>
				</div>

				<div class="row">
				  <div class="span2">Name</div>
				  <div class="span1">Number</div>
				  <div class="span2">Measurement</div>
				  <div class="span1">Type</div>
				</div>


                {% for f in ingredient_formset %}
                <span class="ingredient_formset">
				<div class="row">
                    {{f.id}}
				  <div class="span2">
                    {{f.ingredient}}
				  </div>
				  <div class="span1">
                    {{f.number}}
				  </div>
				  <div class="span2">
                    {{f.measurement}}
				  </div>
				  <div class="span1">
                    {{f.prep}}
				  </div>
				</div>
                {% if f.instance.pk %}{{ f.DELETE }}{% endif %}
                </span>
                {% endfor %}

				<div class="row">
				  <hr class="create-lesson-hr"/>
				</div>

			</div>
		  </div>

		  <div class="span6">
			<div id="create-lesson-form-2-right">
				<div id="createlessontitle">
				  <h5>Tools</h5>
				</div>

				<div class="row">
				  <hr class="create-lesson-hr"/>
				</div>

				<div class="row">
				  <div class="span2">Name</div>
				  <div class="span2">Size</div>
				  <div class="span2">Type</div>
				</div>

                {% for t in tool_formset %}
                <span class="tool_formset">

				<div class="row">
                    {{t.id}}

				  <div class="span2">
                    {{t.name}}
				  </div>
				  <div class="span2">
                    {{t.size}}
				  </div>
				  <div class="span2">
                    {{t.type}}
				  </div>
				</div>
                </span>
                {% endfor %}

				<div class="row">
				  <hr class="create-lesson-hr"/>
				</div>

			</div>
		  </div>

	</div>

	<div class="row">
	  <hr />
	</div>

	<div class="row">
      <div class="span1 pull-right">
      </div>
	  <div class="span1  pull-right">
		  <input type="submit" value="next" class="btn btn-green btn-save">
	  </div>
	  <div class="span1 pull-right">
		<a class="btn btn-green btn-save" href="{% url edit-lesson lesson_id=lesson.id %}">
		  back
		</a>
	  </div>
	</div>
    {{ ingredient_formset.management_form }}
    {{ tool_formset.management_form }}
    </form>


  </div>
</div>


  {% endautoescape %}
  {% endblock %}
