{% extends 'base.html' %}
{% load verbatim %}
{% block media %}

{% verbatim %}
<script id="featured-request-templ" type="text/x-handlebars-template">

{{title}}
{{in_pot}}
{{serving_size}}
{{time_in_min}}
{{description}}
{{need_by}}
{{#each primary_ingredients}}
{{this}}
{{/each}}}
{{#each restrictions}}
{{this}}
{{/each}}
{{#each course}}
{{this}}
{{/each}}}
{{#each cuisine}}
{{this}}
{{/each}}
{{chef}}
{{inpot}}
</script>
{% endverbatim %}

<script type="text/javascript">
require(['common',], function(){
    require(['handlebars'], function(){

        source = $("#featured-request-templ").html();
        template = Handlebars.compile(source);


        $('.lessonrequest').click(function(){
            t = $(this)
            slug = t.data('slug')
            data = lesson_data[slug]
            dest = $("#featuredrequest")
            dest.html(template(data))

        })
    })
})
lesson_data = {{lesson_json|safe}}
$()
</script>
{% endblock %}

{% block content %}

<div class="bordered-row bordered">
  <div class="span12">
	<div class="row">
      <div class="span6">
        <h4>Click on a request for more details</h4>
      </div>

      <div class="span6 request-links">
        Still looking? <a href="#" class="btn btn-green">create a request</a>
        or check out our <a href="{% url lessons %}" class="btn btn-blue">lessons</a>
      </div>
    </div>
  </div>
</div>


<div class="bordered-row bordered">
  <div class="span6" id="featuredrequest"></div>
  <div class="span6">
   {% for req in lesson_requests %}
   <span class="lessonrequest" data-slug="{{req.slug}}">
   <div class="row">
	<div class="span6 request">

 	  <div class="row">
		  <div class="span4 lesson-title">
			<a class="green reqtitle"><h3 class="no-margin">{{req.title}}</h3></a>
		  </div>

		  <div class="span2">
			<h4 class="ask-pot no-margin pull-right">${{req.in_pot|default:"0"}} in pot</h4>
		  </div>
      </div>

	  <div class="row">
		<div class="span4">
		  <div class="lesson-tile-description">
		    <small>{{req.description}}</small>
		  </div>
        </div>

        <div class="span2">
		  <div class="timetoraise pull-right"><strong>{{req.need_by|timeuntil}} left</strong></div>
          <div class="attatchedchef pull-right"><strong>by <a href="#" class="green">{{req.chef_attatched|default:"No Chef yet!"}}</strong></a></div>
		</div>
      </div>

    </div>
   </div>
   </span>
   {% endfor %}
  </div>
</div>


{% include "pager.html" with lesson_requests=pager %}
{% endblock %}
